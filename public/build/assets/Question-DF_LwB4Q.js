import{r as d,j as e,D as v,b as _,c as w,B as C,aI as a,aN as L}from"./app-CJdbH9Yc.js";import{u as S}from"./Orders-CaKxEZtn.js";const P=({setOpenDialog:n,openDialog:m,carts:r,user:o,shipping:c,MIDTRANS_CLIENT_KEY:f})=>{const[y,h]=d.useState(!1),[g,l]=d.useState(!1),{addData:j}=S();d.useEffect(()=>{const s=document.createElement("script");return s.src="https://app.sandbox.midtrans.com/snap/snap.js",s.setAttribute("data-client-key",f||""),s.onload=()=>h(!0),document.body.appendChild(s),()=>{document.body.removeChild(s)}},[]);const x=async()=>{l(!0);const s=r.reduce((k,p)=>k+p.product.price*p.quantity,0),u=s+c.shipping_cost,i={user_id:o==null?void 0:o.id,shipping_cost_id:c.id,total_price:s,total_payment:u,status:"tunggu",carts:r},t=await j(i);console.log({res:t}),t.status==="success"&&(n(!1),b(t.data.data),a.visit("/orders")),l(!1)},b=async s=>{if(!y){alert("Snap.js is not loaded yet!");return}const i=(await L.post("/payment",{order_id:s.id})).data;window.snap.pay(i,{onSuccess:function(t){console.log({result:t}),a.visit("/orders")},onPending:function(t){console.log({result:t}),a.visit("/orders")},onError:function(t){console.log({result:t}),a.visit("/orders")},onClose:function(){console.log("user closed the popup")}})};return e.jsxs(v,{openDialog:m,setOpenDialog:n,title:"Lanjut Ke Proses Pembayaran ?",children:[e.jsx("p",{children:"Anda tidak dapat mengubah pesanan setelah melanjutkan ke proses pembayaran."}),e.jsx(_,{children:e.jsxs("div",{className:"w-full flex gap-x-2 justify-center items-end",children:[!g&&e.jsx(w,{addClass:"bg-primary",onClick:x,children:"Lanjut"}),e.jsx(C,{variant:"outline",onClick:()=>n(!1),children:"Tidak"})]})})]})};export{P as default};
